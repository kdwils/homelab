---
# Source: homelab/charts/envoy-proxy-gatekeeper/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: envoy-proxy-gatekeeper
  labels:
    helm.sh/chart: envoy-proxy-gatekeeper-0.1.11
    app.kubernetes.io/name: envoy-proxy-gatekeeper
    app.kubernetes.io/instance: envoy-proxy-gatekeeper
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
automountServiceAccountToken: false
---
# Source: homelab/charts/envoy-proxy-gatekeeper/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: envoy-proxy-gatekeeper
  labels:
    helm.sh/chart: envoy-proxy-gatekeeper-0.1.11
    app.kubernetes.io/name: envoy-proxy-gatekeeper
    app.kubernetes.io/instance: envoy-proxy-gatekeeper
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: 8081
      targetPort: 8080
      protocol: TCP
      name: grpc
    - port: 8080
      targetPort: 8080
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: envoy-proxy-gatekeeper
    app.kubernetes.io/instance: envoy-proxy-gatekeeper
---
# Source: homelab/charts/envoy-proxy-gatekeeper/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: envoy-proxy-gatekeeper
  labels:
    helm.sh/chart: envoy-proxy-gatekeeper-0.1.11
    app.kubernetes.io/name: envoy-proxy-gatekeeper
    app.kubernetes.io/instance: envoy-proxy-gatekeeper
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app.kubernetes.io/name: envoy-proxy-gatekeeper
      app.kubernetes.io/instance: envoy-proxy-gatekeeper
  template:
    metadata:
      labels:
        helm.sh/chart: envoy-proxy-gatekeeper-0.1.11
        app.kubernetes.io/name: envoy-proxy-gatekeeper
        app.kubernetes.io/instance: envoy-proxy-gatekeeper
        app.kubernetes.io/version: "1.16.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      serviceAccountName: envoy-proxy-gatekeeper
      securityContext:
        {}
      containers:
        - name: envoy-proxy-gatekeeper
          image: "ghcr.io/kdwils/envoy-proxy-gatekeeper:v0.0.1"
          imagePullPolicy: IfNotPresent
          ports:
            - name: grpc
              containerPort: 8080
              protocol: TCP
            - name: http
              containerPort: 8080
              protocol: TCP
          env:
            - name: GATEKEEPER_CAPTCHA_CHALLENGEDURATION
              value: "5m"
            - name: GATEKEEPER_CAPTCHA_COOKIEDOMAIN
              value: "kyledev.co"
            - name: GATEKEEPER_CAPTCHA_COOKIENAME
              value: "kyledev.co"
            - name: GATEKEEPER_CAPTCHA_PROVIDER
              value: "turnstile"
            - name: GATEKEEPER_CAPTCHA_SESSIONDURATION
              value: "6h"
            - name: GATEKEEPER_CAPTCHA_SITEKEY
              value: "0x4AAAAAAB1bbQbIpIhvAYwl"
            - name: GATEKEEPER_LOGLEVEL
              value: "debug"
            - name: GATEKEEPER_SERVER_GRPCPORT
              value: "8081"
            - name: GATEKEEPER_SERVER_HOST
              value: "gatekeeper.int.kyledev.co"
            - name: GATEKEEPER_SERVER_HTTPPORT
              value: "8080"
          envFrom:
            - secretRef:
                name: envoy-proxy-gatekeeper
---
# Source: homelab/charts/envoy-proxy-gatekeeper/templates/httproute.yaml
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: gatekeeper-int
  labels:
    helm.sh/chart: envoy-proxy-gatekeeper-0.1.11
    app.kubernetes.io/name: envoy-proxy-gatekeeper
    app.kubernetes.io/instance: envoy-proxy-gatekeeper
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  parentRefs:
    - name: homelab
      namespace: envoy-gateway-system
  hostnames:
    - "gatekeeper.int.kyledev.co"
    - "gatekeeper.ts.kyledev.co"
  rules:
    - backendRefs:
      - group: ""
        kind: Service
        name: envoy-proxy-gatekeeper
        port: 8080
---
# Source: homelab/charts/envoy-proxy-gatekeeper/templates/sealedsecret.yaml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: envoy-proxy-gatekeeper
  namespace: envoy-gateway-system
spec:
  encryptedData:
    GATEWAY_CAPTCHA_SECRETKEY: AgCIh3Ew+FP5jb/8L/xiIrh+yuqj+qrP68T4YM9I04iIo7Fz2Q6jI4lbWqerRZHeoCJlcQubRrqbkhsgvUD7NDSpPuf8hGZLuHBJZ8sK70fVY85kk8YWMABwfUOfGb2BVBsTxnI1C1vQXSOEkYswIyZaCJEEUYSRulecyfpaK1uS58AOFy/qjieXJJ1dEE6ecJiICniLnPd57CwVdhv4p/aubryC/7pbXITLL4TYd4qmzd5Veb0Nnvp7fyE5keFb4BDdJUiw7Scv/MsVtzAuAytulyC+BCg56zgY8cSpCrjaxCQGkE8IvkHRQNCQ1ebvyiJocBgR9rWuoVyzWlGZq4PWYFjgE4utoqPD+snr+SI+B5hdR9sewo8GI2fGV64TjUsxS9vMgCNa3+VY1h9OYZMq7b/jFEMMwSEYh4l3llzGM/5hVrrcUUgCyIEYjPTgKztHCllk+F7wQU49gZtWaT2dnnVmHrv6vBttQqPrkLjvbZfVcbEgvxSq4OqdZ3OuwmwdAKIDeavj9iIsaUej/YE2GE3LMaYImKZ4fmy9uC0mOdme+MWcnkwyyBz7ko+KaBvlTBGlO5ws/bx3KPnaPu0Xgq7AiVcRRaTwaAZ6BDCYX8BGmLrfuFhE+0LScdAns9pakAs8PO3d9GWc6U/esQRG91j5Gwpq8BQvs601IPC9Lj7MYZ2fnGs8hTZBBlUcpVBOCK9Lri23cxGF/7kONOJkNRbxkWgohem4COBSfYEWy7iebQ==
    GATEWAY_CAPTCHA_SIGNINGKEY: AgCWOFriSA7FJ4+vcTLNLFCi2m0aoQQt7+AecmYA6DQJxppVJH35mzGGychZ702m6MLUI79EdMP4LJLg/UD2DwsQfXpID832DhoLGcGJMpToezuauK1Q5BNYMYYyyPGSoxKGtlnqBjktO404SlE8rSHEsNI1AUMvbZQc23KoNftP1nPXqNtjdNOQF0Lu5etws574sFunl9gKx1O5HFCX4mbFlPBoPeJ2o9RMtv0lL0pHrsieMTB1ZZqgD/ou9wouq8oqsASJeZ8yQYJ1ve43Jvc8UYgxoRDRXPSZlInQmkAZG0InmgfSUiqAjiucbw755VcYatsMAGel8f6xarKzHSCpup4XQ2nIIfHgr/q8nJ/Mi3aUUvRWRe2piTCU83qzcAXb+YQzdoUk04Z1uRrsA1dh2gQclXivXsFD7kOmxdXa1zWSCGWg+pdkAw1BHZ4/pZ+skIrzmBau4YlBavTrIaWqsF2Q9RHGgJxEETV2sCfcidKG5/IryauOxslvqP0mh0FzlWC63p1IAinpw4mzIG37MhY1ljB9KCRg4oBGMXyL33tbG+6rmyImLclHCvedIgTGw5ABEjI3+mUS+gBteIRLaATbCWS0/nr15ri6ybu8qSsCLr17KD3schefQbIKU8rD6JERXa3DQ4LQgFKi8GXWzaM4Q2IpLDb3Z7aIZwqGaYuhKSlbgXwLaGkRVs+V7cILk8LvL6iElN4ZHiw1RgMWVR11kZHE+h4s+jLgpMLWtrn4OhIxkIW8PEAtrMV9JEmAw/AbmCOgg7q6L/M3u/st
    GATEWAY_TRUSTEDPROXIES: AgAfPyVqKc3/gj5eta8x5j7FiHvOpof+1f6ec2z7w8qRbvuJkK5u6Nt+44K3hXlBqVZMqiwJAyQyTPAAtvLglvi4uF47wD47x+6edolvm02zM6gryi8F5pPYMFnIsAlNxcLZxvDAnS7VHMRioWuw56OMfNTbf1ZExXDc/L9HuZS6bIKR6wS6I5p6FRP/1+fIEiZtBnxXvLes3MylfuH0kaxkDIrlllw3hNdN5I9Vwr1INwouFSxqSI/rRKDFZhQc5B04zLek81d0PokzbAWmO3RWZaLbNgPQwAiV19q9V4tQKJv2R+AjMvxg6WkmRUQjoHYUcE2bbiyC2mI4dTD9s4Kq9PAXQYJ6vzmMjwvNTxsesRsMuPWZcXNVuLKrziAfCI3x6jH2eaQwhi9mUzzdzlaeEEjyMLhCoqvu1OYBiTkyl1FTD1dYcTC5SK0M6pWpMsH+DJ/lb+I79Gv6qz07/wfw4U+NnMA3HArUzN7hDqFegqAzJ6icsICX71b3pyHpmW7GGmDviHMeRlSobKsdmXH3Mere6TgbLCHbQn9jyoaZowVh1FyaccBsdQ/ED+pVHTftR951hr/uMbja14QpczxNDmGOTuBKRCU3Q8nVwCVpePBGa7VeLW2ktWeYhOAeJbmh4v0OASecl0ySjNVyPm6xFkVosrMwkwECYBbbSI+VA8CJxlN/LrXnduIGVChGSlHwFRY32geBjcm+Ppw=
  template:
    type: Opaque
    metadata:
      name: envoy-proxy-gatekeeper
      namespace: envoy-gateway-system
