events:
  configmap:
    create: true
    configmaps:
      - name: config
        mountPath: /app/config.yaml
        readOnly: true
        data:
          config.yaml: |
            logLevel: info
            server:
              port: 8080
            db:
              file: /data/db.sqlite
            nats:
              host: nats.int.kyledev.co
              secure: true
              enabled: true
              jetstream:
                enabled: true
                streams:
                  - name: "events"
                    subjects:
                      - "events.*"
                    storage: "file"
                consumers:
                  - name: "events"
                    streamName: "events"
                    ackPolicy: "explicit"
                    deliverPolicy: "new"

  serviceAccount:
    create: true
    automount: false

  deployment:
    create: true
    replicaCount: 1
    deployStrategy: Recreate

    image:
      repository: ghcr.io/kdwils/events
      tag: sha-2cc6bc04fd0473409c3dc99fad12ba34f8c952a6
      pullPolicy: IfNotPresent

    args:
      - serve
      - --config=/app/config.yaml

    podSecurityContext:
      runAsNonRoot: true
      runAsUser: 1000
      runAsGroup: 1000
      fsGroup: 1000

    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL

    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 50m
        memory: 64Mi

  service:
    create: true
    type: ClusterIP
    port: 8080
    targetPort: 8080
    name: http

  httproute:
    create: true
    hostnames:
      - "events.int.kyledev.co"
      - "events.ts.kyldev.co"
    parentRefs:
      - name: homelab
        namespace: envoy-gateway-system

  pvc:
    create: true
    pvcs:
      - name: events-data-pvc
        size: 10Gi
        storageClassName: ""
        accessMode: ReadWriteOnce
        mountPath: /data
