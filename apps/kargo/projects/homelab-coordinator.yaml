apiVersion: v1
kind: Namespace
metadata:
  name: homelab-coordinator
  labels:
    kargo.akuity.io/project: "true"
---
apiVersion: kargo.akuity.io/v1alpha1
kind: Project
metadata:
  name: homelab-coordinator
---
apiVersion: kargo.akuity.io/v1alpha1
kind: ProjectConfig
metadata:
  name: homelab-coordinator
  namespace: homelab-coordinator
spec:
  promotionPolicies:
    - stageSelector:
        name: deploy
      autoPromotionEnabled: true
---
apiVersion: kargo.akuity.io/v1alpha1
kind: Warehouse
metadata:
  name: homelab-coordinator
  namespace: homelab-coordinator
spec:
  subscriptions:
    # Watch all app values files on main branch
    - git:
        repoURL: https://github.com/kdwils/homelab.git
        branch: main
        includePaths:
          # Apps
          - glob: apps/mealie/environments/**
          - glob: apps/rss/environments/**
          - glob: apps/bluesky/environments/**
          - glob: apps/pocketid/environments/**
          - glob: apps/excalidraw/environments/**
          - glob: apps/overseerr/environments/**
          - glob: apps/prowlarr/environments/**
          - glob: apps/bazarr/environments/**
          - glob: apps/radarr/environments/**
          - glob: apps/sonarr/environments/**
          - glob: apps/hoarder/environments/**
          - glob: apps/events/environments/**
          - glob: apps/blog/environments/**
          - glob: apps/nats/environments/**
          # Infra
          - glob: infra/cloudflared/environments/**
          - glob: infra/longhorn/environments/**
          - glob: infra/sealedsecrets/environments/**
          - glob: infra/tailscale/environments/**
          # Media
          - glob: media/byparr/environments/**
          - glob: media/plex/environments/**
          # Monitoring
          - glob: monitoring/envoy-proxy-bouncer/environments/**
          - glob: monitoring/envoy-proxy-gatekeeper/environments/**
          # Shared charts
          - glob: charts/**
---
apiVersion: kargo.akuity.io/v1alpha1
kind: Stage
metadata:
  name: deploy
  namespace: homelab-coordinator
spec:
  requestedFreight:
    - origin:
        kind: Warehouse
        name: homelab-coordinator
      sources:
        direct: true
  promotionTemplate:
    spec:
      steps:
        - task:
            name: render-all-apps
            kind: PromotionTask
