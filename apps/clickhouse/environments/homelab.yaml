homelab:
  httproutes:
    - name: hyperdx
      parentRefs:
        - name: homelab
          namespace: envoy-gateway-system
      hostnames:
        - hyperdx.int.kyledev.co
      rules:
        - matches:
            - path:
                type: PathPrefix
                value: /
          backendRefs:
            - name: clickstack-hyperdx
              port: 3000
    - name: collector
      parentRefs:
        - name: homelab
          namespace: envoy-gateway-system
      hostnames:
        - otel.int.kyledev.co
      rules:
        - matches:
            - path:
                type: PathPrefix
                value: /v1
          backendRefs:
            - name: clickstack-otel-collector
              port: 4318
  sealedsecrets:
    - name: clickhouse
      data:
        connections.json: AgAGORWrjL9iOL/UtMBguKPNPMxSlaeVHLlRPeY7Be0FMwerlWYqd+xH7ADdqekbdmOr0uCVle7usTvFhYowBB5ofHgRKmH/AeC784ePe3vKsfNsNmRvpyV8EnEr+6jyogiPg9iHjXbrViq+sdTJqlQc8ORivOJxI2173ABirhzkjiXN7UtbJKOKHc3o2SAkaUqPefS1x+e2xFBCFfXRA1h8eZbvHM/gvGf9H3GMq9o6aDSVPPDVr3kzLYCsl3xoP78Z3Uv/PAm3X3qwkz2sooTu8gnmyWUSMcyqcx7DqmWNmLVSImAI3lZBBaCRQykyYzn0XMUEXl6fSZZ6NAz5EMleU/dN4zqb1gepmmBVzPrx5DhmH05Jn4ui0bcGDcR5WcEzAZWuJ9V109SpvRmN+Li3S9Yousz935ZCb+jN8Oq0NZHLzEKI+G6Fnq+4oixgFbQgF4AzLU4QyeBTz8MBIBWQDhdCiIjCqcYr7OcwxPpWrj3/+QewpnwlszOBmNzlnHdTU28wmShIs2xrdt0ytpX2jyofCZk0m+zmTG53iZBJZtYW6A7KH6OoK/eokzTuX9KOKyTP58JMoAldcVZayrohFUEYSvvei+MzypX4LtY5vDsdhOuXH5BZwjcDXqHBgKPf8zQqRIGIXL5V1achi9XyVGUXSvN75k1ZmPqSzh3rkbdCpR4YliosLMGPizeI67MNAh039VDkxiM88cMzUJMbr/hBQnQ7qzJ6dvtLAikBeF5A8TdDGNGiP56ld1JHSj5N77eLgMPhejGZzj9Zr/vMpUd7KM3vBvWTLCZjYpKalx3qcFBEws7N1LItVVLMoL9KqvKe0XOGUsI0Jt5WNEU8u0itoZmU7YGltssC9M38yBMSV3znYR+2KpqPzaBwZuQt2WJF+IyND6qCol+wC8/XuBaCHLkKjMEhmMc=
        hyperdxApiKey: AgBOMoNGFAjP8VZUun2q2YGoLO+24Jx544JHo+mHF/ADWfV7A4mY0sS9RyWO4fheQn/7TirGbOgQ2fg+7pvwIM+aiDUEVhfBN9yFLlvpToSGhjGSG0gLnE4Jbp7EA/04KPJvYHak3L1Wg1wo/RZsdapMefpIZMlXWPdrZ8nWFHzlZkmLNQeHjLDwKgJ2i3jz3tYKO/63mt1nOE2Ftgh6E90BwMg/oNGyzImw40l3s0KFkkHzl0S0MhK5L+Vpq91IfzAkk2ZSOZdXT5lchhcR8j5w9Ucliib1Z5RKtC9O344UyhwSGRnBMaLV/Pb9hzQ60CZsDgkPyUo8nEC6DLapqXb2vkZQsPPnxGfbmCBjsjJ69NM1t6kvzeeHEfeKmH3aMHL2rYuZ1vCncOpw5x7GYbCLO8rUS0bfvjN9jdLmOOi4j4e+M2JdEVL3UbhXDNjHVrkXeZ0Xj4LG6oB3wBdJEnwpufwHiffeTHLLj23bVDW6CPOaskYhd2YcfLuE64G5swNAKXQXw1CXHXLPIjc5CYpOIK4mIUYlxLhdAVrIcZM+4TANE7uyrX96sdP9fiGOmPNOWgyarrdFiupVGw+J2erfxM6nZoh9rm2N0JYhX7klYn40StHz30eal5phhyNIYUV3OL8inPE2SraR4SgYABLmR1RREas9lAvCOzKHuY7dMyE+TT0rX4nCpRGuXi6nay2fsUk8fNLsW3JuAlRbMi1IHrE+8qyPK4X30UK+ZK75K7ijja+cVFlLmR3b9hWv++sibMkgaGkSYoAsL16SJuHs

clickhouse:
  global:
    imageRegistry: ""
    # List of image pull secrets to use for pulling images from private registries
    # This helps avoid rate limiting (429 errors) when pulling from Docker Hub
    # Example:
    # imagePullSecrets:
    #   - name: regcred
    #   - name: docker-hub-secret
    imagePullSecrets: []
    # storageClassName: "local-path"
    # Keep PVCs when uninstalling helm release to preserve data
    keepPVC: false

  hyperdx:
    image:
      repository: docker.hyperdx.io/hyperdx/hyperdx
      tag:
      pullPolicy: IfNotPresent
    waitForMongodb:
      # Image used by the init container that waits for MongoDB to be reachable.
      image: "busybox@sha256:1fcf5df59121b92d61e066df1788e8df0cc35623f5d62d9679a41e163b6a0cdb"
      pullPolicy: IfNotPresent
    livenessProbe:
      enabled: true
      initialDelaySeconds: 10
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readinessProbe:
      enabled: true
      initialDelaySeconds: 1
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
    # Add nodeSelector and tolerations for hyperdx service
    nodeSelector: {}
      # Example:
      # kubernetes.io/os: linux
      # node-role.kubernetes.io/worker: "true"
    tolerations: []
      # Example:
      # - key: "key1"
      #   operator: "Equal"
      #   value: "value1"
      #   effect: "NoSchedule"
  apiKey:
    valueFrom:
      secretKeyRef:
        name: clickhouse
        key: HYPERDX_API_KEY
    # apiKey: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    apiPort: 8000
    appPort: 3000
    opampPort: 4320
    # deprecated: use frontendUrl instead
    # appUrl: "http://localhost"
    # The URL that will be use to access the frontend. Defaults to the http://localhost:3000.
    # If you have an ingress enabled, you should set this to the ingress host with the protocol. E.g. https://hdx-my-domain.com
    frontendUrl: hyperdx.int.kyledev.co
    logLevel: "info"
    usageStatsEnabled: true
    # Endpoint to send hyperdx logs/traces/metrics to.Defaults to the chart's otel collector endpoint.
    otelExporterEndpoint: http://{{ include "clickstack.fullname" . }}-otel-collector:{{ .Values.otel.httpPort }}
    mongoUri: mongodb://{{ include "clickstack.fullname" . }}-mongodb:{{ .Values.mongodb.port }}/hyperdx

    # Pod-level annotations (applied to the deployment pods)
    annotations: {}
      # myAnnotation: "myValue"

    # Pod-level labels (applied to the deployment pods)
    labels: {}
      # myLabel: "myValue"
    env: []
      # Additional environment variables can be configured here
      # This is preserved for backward compatibility and advanced use cases

    # Default connections and sources (ENABLED BY DEFAULT)
    # Set to empty string to disable: defaultConnections: "" or defaultSources: ""
    #
    # To use an existing secret instead of inline configuration, set:
    useExistingConfigSecret: true
    # existingConfigSecret: "my-hyperdx-config"
    # existingConfigConnectionsKey: "connections.json"  # defaults to "connections.json"
    # existingConfigSourcesKey: "sources.json"  # defaults to "sources.json"
    #
    # The secret should contain separate keys for connections and sources JSON arrays
    # useExistingConfigSecret: false
    existingConfigSecret: "clickhouse"
    existingConfigConnectionsKey: "connections.json"
    existingConfigSourcesKey: "sources.json"

    # defaultConnections: |
    #   [
    #     {
    #       "name": "Local ClickHouse",
    #       "host": "http://{{ include "clickstack.fullname" . }}-clickhouse:8123",
    #       "port": 8123,
    #       "username": "app",
    #       "password": "{{ .Values.clickhouse.config.users.appUserPassword }}"
    #     }
    #   ]

    # Set to empty string to disable: defaultSources: ""
    defaultSources: |
      [
        {
          "from": {
            "databaseName": "default",
            "tableName": "otel_logs"
          },
          "kind": "log",
          "timestampValueExpression": "TimestampTime",
          "name": "Logs",
          "displayedTimestampValueExpression": "Timestamp",
          "implicitColumnExpression": "Body",
          "serviceNameExpression": "ServiceName",
          "bodyExpression": "Body",
          "eventAttributesExpression": "LogAttributes",
          "resourceAttributesExpression": "ResourceAttributes",
          "defaultTableSelectExpression": "Timestamp,ServiceName,SeverityText,Body",
          "severityTextExpression": "SeverityText",
          "traceIdExpression": "TraceId",
          "spanIdExpression": "SpanId",
          "connection": "Local ClickHouse",
          "traceSourceId": "Traces",
          "sessionSourceId": "Sessions",
          "metricSourceId": "Metrics"
        },
        {
          "from": {
            "databaseName": "default",
            "tableName": "otel_traces"
          },
          "kind": "trace",
          "timestampValueExpression": "Timestamp",
          "name": "Traces",
          "displayedTimestampValueExpression": "Timestamp",
          "implicitColumnExpression": "SpanName",
          "serviceNameExpression": "ServiceName",
          "bodyExpression": "SpanName",
          "eventAttributesExpression": "SpanAttributes",
          "resourceAttributesExpression": "ResourceAttributes",
          "defaultTableSelectExpression": "Timestamp,ServiceName,StatusCode,round(Duration/1e6),SpanName",
          "traceIdExpression": "TraceId",
          "spanIdExpression": "SpanId",
          "durationExpression": "Duration",
          "durationPrecision": 9,
          "parentSpanIdExpression": "ParentSpanId",
          "spanNameExpression": "SpanName",
          "spanKindExpression": "SpanKind",
          "statusCodeExpression": "StatusCode",
          "statusMessageExpression": "StatusMessage",
          "connection": "Local ClickHouse",
          "logSourceId": "Logs",
          "sessionSourceId": "Sessions",
          "metricSourceId": "Metrics"
        },
        {
          "from": {
            "databaseName": "default",
            "tableName": ""
          },
          "kind": "metric",
          "timestampValueExpression": "TimeUnix",
          "name": "Metrics",
          "resourceAttributesExpression": "ResourceAttributes",
          "metricTables": {
            "gauge": "otel_metrics_gauge",
            "histogram": "otel_metrics_histogram",
            "sum": "otel_metrics_sum",
            "_id": "682586a8b1f81924e628e808",
            "id": "682586a8b1f81924e628e808"
          },
          "connection": "Local ClickHouse",
          "logSourceId": "Logs",
          "traceSourceId": "Traces",
          "sessionSourceId": "Sessions"
        },
        {
          "from": {
            "databaseName": "default",
            "tableName": "hyperdx_sessions"
          },
          "kind": "session",
          "timestampValueExpression": "TimestampTime",
          "name": "Sessions",
          "displayedTimestampValueExpression": "Timestamp",
          "implicitColumnExpression": "Body",
          "serviceNameExpression": "ServiceName",
          "bodyExpression": "Body",
          "eventAttributesExpression": "LogAttributes",
          "resourceAttributesExpression": "ResourceAttributes",
          "defaultTableSelectExpression": "Timestamp,ServiceName,SeverityText,Body",
          "severityTextExpression": "SeverityText",
          "traceIdExpression": "TraceId",
          "spanIdExpression": "SpanId",
          "connection": "Local ClickHouse",
          "logSourceId": "Logs",
          "traceSourceId": "Traces",
          "metricSourceId": "Metrics"
        }
      ]

    replicas: 1

    podDisruptionBudget:
      enabled: false

    # Service configuration
    service:
      type: ClusterIP # Use ClusterIP for security. For external access, use ingress with proper TLS and authentication
      # Service-level annotations (applied to the Kubernetes service resource)
      annotations: {}
        # Example service annotations:
        # service.beta.kubernetes.io/aws-load-balancer-internal: "true"
        # cloud.google.com/load-balancer-type: "Internal"

  mongodb:
    image: "mongo:5.0.32-focal"
    port: 27017
    enabled: true
    # Add nodeSelector and tolerations for mongodb service
    nodeSelector: {}
      # Example:
      # kubernetes.io/os: linux
      # node-role.kubernetes.io/worker: "true"
    tolerations: []
      # Example:
      # - key: "key1"
      #   operator: "Equal"
      #   value: "value1"
      #   effect: "NoSchedule"
    persistence:
      enabled: true
      dataSize: 10Gi
    livenessProbe:
      enabled: true
      initialDelaySeconds: 10
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readinessProbe:
      enabled: true
      initialDelaySeconds: 1
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3

  clickhouse:
    image: "clickhouse/clickhouse-server:25.7-alpine"
    port: 8123
    nativePort: 9000
    terminationGracePeriodSeconds: 90
    resources: {}
      # Example:
      # requests:
      #   memory: "512Mi"
      #   cpu: "500m"
      # limits:
      #   memory: "2Gi"
      #   cpu: "2000m"
    livenessProbe:
      enabled: true
      initialDelaySeconds: 10
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readinessProbe:
      enabled: true
      initialDelaySeconds: 1
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
    startupProbe:
      enabled: true
      initialDelaySeconds: 5
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 30
    enabled: true
    # Add nodeSelector and tolerations for clickhouse service
    nodeSelector: {}
      # Example:
      # kubernetes.io/os: linux
      # node-role.kubernetes.io/worker: "true"
    tolerations: []
      # Example:
      # - key: "key1"
      #   operator: "Equal"
      #   value: "value1"
      #   effect: "NoSchedule"

    # Service configuration
    service:
      type: ClusterIP # Use ClusterIP for security. For external access, use ingress with proper TLS and authentication
      # Service-level annotations (applied to the Kubernetes service resource)
      annotations: {}
        # Example service annotations:
        # service.beta.kubernetes.io/aws-load-balancer-internal: "true"
        # cloud.google.com/load-balancer-type: "Internal"

    persistence:
      enabled: true
      dataSize: 10Gi
      logSize: 5Gi
    prometheus:
      enabled: true
      port: 9363
      endpoint: "/metrics"
    config:
      # users:
      #   appUserPassword: "hyperdx"
      #   otelUserPassword: "otelcollectorpass"
      #   otelUserName: "otelcollector"
      # Network CIDRs for Kubernetes cluster access control
      # These CIDRs ensure ClickHouse connections are locked down to intra-cluster only
      # For PRODUCTION: Remove development CIDRs and keep only your cluster's specific CIDR
      # For DEVELOPMENT: Multiple common CIDRs are included for convenience
      clusterCidrs:
        - "10.0.0.0/8" # Most Kubernetes clusters (including GKE, EKS, AKS)
        - "172.16.0.0/12" # Some cloud providers and Docker Desktop
        - "192.168.0.0/16" # OrbStack, Minikube, and local development

  otel:
    image:
      repository: docker.clickhouse.com/clickhouse/clickstack-otel-collector
      tag:
      pullPolicy: IfNotPresent
    replicas: 1
    resources: {}
      # Example:
      # requests:
      #   memory: "127Mi"
      #   cpu: "100m"
      # limits:
      #   memory: "256Mi"
      #   cpu: "200m"
    # Pod-level annotations (applied to the deployment pods)
    annotations: {}
      # myAnnotation: "myValue"
    # Add nodeSelector and tolerations for otel-collector service
    nodeSelector: {}
      # Example:
      # kubernetes.io/os: linux
      # node-role.kubernetes.io/worker: "true"
    tolerations: []
      # Example:
      # - key: "key1"
      #   operator: "Equal"
      #   value: "value1"
      #   effect: "NoSchedule"
    port: 13133
    nativePort: 24225
    grpcPort: 4317
    httpPort: 4318
    healthPort: 8888
    enabled: true
    env: []
      # Additional environment variables can be configured here
      # Example:
      # - name: CUSTOM_VAR
      #   value: "my-value"
      # - name: SECRET_VAR
      #   valueFrom:
      #     secretKeyRef:
      #       name: my-secret
      #       key: secret-key
    # Custom OTEL Collector config - allows you to provide your own OTEL Collector configuration
    # Provide your OTEL Collector configuration as a multi-line string
    # This will be mounted as /etc/otelcol-contrib/custom.config.yaml and
    # the CUSTOM_OTELCOL_CONFIG_FILE environment variable will point to it
    # Example:
    # customConfig: |
    #   receivers:
    #     hostmetrics:
    #       collection_interval: 5s
    #       scrapers:
    #         cpu:
    #         load:
    #         memory:
    #   service:
    #     pipelines:
    #       metrics/hostmetrics:
    #         receivers: [hostmetrics]
    #         processors: [memory_limiter, batch]
    #         exporters: [clickhouse]
    customConfig:
    # Opamp server URL - defaults to the app service. Customize if you want to use a different Opamp server.
    # Leave empty if you want to use the app service.
    # Example: opampServerUrl: "http://custom-opamp-server:4320"
    opampServerUrl:
    # Clickhouse endpoint - defaults to chart's Clickhouse service. Customize if you want to use a different Clickhouse service.
    # Leave empty if you want to use the chart's Clickhouse service.
    # Example: clickhouseEndpoint: "tcp://custom-clickhouse-service:9000"
    clickhouseEndpoint:
    clickhouseUser:
    clickhousePassword:
    # Clickhouse Prometheus endpoint - defaults to chart's Clickhouse prometheus service. Customize if you want to use a different Clickhouse prometheus service.
    # Leave empty if prometheus is disabled.
    # Example: clickhousePrometheusEndpoint: "http://custom-clickhouse-service:9363"
    clickhousePrometheusEndpoint:
    # Clickhouse database to send logs/traces/metrics to. Defaults to "default"
    clickhouseDatabase: "default"
    livenessProbe:
      enabled: true
      initialDelaySeconds: 10
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readinessProbe:
      enabled: true
      initialDelaySeconds: 5
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
