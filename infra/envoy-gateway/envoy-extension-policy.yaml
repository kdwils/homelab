apiVersion: gateway.envoyproxy.io/v1alpha1
kind: EnvoyExtensionPolicy
metadata:
  name: wasm-traffic-plugin
  namespace: envoy-gateway-system
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: Gateway
      name: homelab
  wasm:
    - name: traffic-plugin
      failOpen: true
      rootID: envoy-events
      code:
        type: Image
        image:
          url: ghcr.io/kdwils/envoy-wasm-traffic-plugin:sha-9d5045a71e9c019c11bf1dbef802d8d67ca0b40e
      config:
        webhook_cluster: "webhook_cluster"
        webhook_authority: "events.events.svc.cluster.local"
        webhook_path: "/api/v1/events/envoy-gateway/http_request"
        trusted_proxies:
          - "10.42.0.0/16"
