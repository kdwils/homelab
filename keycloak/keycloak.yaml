apiVersion: v1
kind: Namespace
metadata:
  name: keycloak
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: keycloak-secret
  namespace: keycloak
spec:
  encryptedData:
    keycloak-password: <encrypted-password>
    keycloak-user: <encrypted-user>
    truststore-password: <encrypted-password>
  template:
    metadata:
      name: keycloak-secret
      namespace: keycloak
    type: Opaque
---
apiVersion: k8s.keycloak.org/v2alpha1
kind: Keycloak
metadata:
  name: keycloak
  namespace: keycloak
spec:
  instances: 1
  db:
    vendor: mysql
    host: mysql
    port: 3306
    usernameSecret:
      name: mysql-secret
      key: mysql-user
    passwordSecret:
      name: mysql-secret
      key: mysql-password
  http:
    tlsSecret: keycloak-tls
  hostname:
    hostname: keycloak.int.kyledev.co
  podDisruptionBudget:
    minAvailable: 1
  externalAccess:
    enabled: true
    host: keycloak.int.kyledev.co
    tls:
      secretName: keycloak-tls
  additionalOptions:
    - name: proxy
      value: edge
    - name: cache
      value: local
