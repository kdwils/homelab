apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: tunnel
  namespace: cloudflared
spec:
  encryptedData:
    cert.pem: AgC4OP+nfnElgXYWylVS4v63MzLhKIZKD64RKNR24dNgb6TIo5lJBfN+Qj8GOv6fZt/lzLWV9N3d4FE7cXMioJkeqvvkAfYtAGpaZQBWLJXA3VchG9EE9+3aBvoZGvzgwseIvFOnk6266zF9jKot5yNUHi6jMchgnocVOQUzywAP+eIdk6bs71c8bFzZu+A+LtL2U2IrLpKMpIidc6i+POc1E1ajX7FJ9QcZRs0MITFy6ziLWKrabum2twCa1ZGW9OurGQ4k0wfnFHlWmuBR6PzOqvSSgG0VRQvaVr/yR6P3Hlh8NrrZMTpFckPI8XS9R4y3aWrSqimG08EIzCWsjfLOHOuhObB1TzQMFE9o8peOnfFf8NG6eUN4NvekOfGNe6r7NIrEhv71McomRaoq5Nn+cVIHNtuLgAx4s+NZZj+U7sZz/Y50i6IY5sCM3LbpM0D3KgW6qT+pgNirqyENCa/L8mQGgXtK3GIKXLfV6FhrGKWlqHskczg1MVCT2GqceCFSfl3zsH61eTug/9txzL8B3Huz9ZWtpAjh3mx5xITT0wshw7TvgmhxMAKOyeOTj7EU+7GSjuMIHtymdDQW3Uoimc8HH16PsdRgV9yZMZVS8HprZofXXCkZOY6TgCM99hbFZzeCKmd/AD3FJpGGQRECadStmWS9B+HmKfB7+h/XEKRMezYd3kM6wNGRf4Z+XX44EtwwndRAOu/intiqoo2DeA73GVICqJoPyV+rRrG+NKNOJShi0eaUSyMBpL5g80hJXGxTVCsoClvtRlTsGO/LUsc3rHZPgzlxY+18NqqSzURyaAirwqZnh8YfcBKhFzWe5KOuq1cBvxjLbufIkN0G/poILhpkcUlGFBjU41hnNCDyXD9ROPZtGTmC/Rb4IUfYhkr267BAolZvJoXUszRzafogilxOeBCLPHQYSI9eXoB5VIgaH+iH+euAxF5/NEk83+WkkW+uznExQvdSbDEt1EzHceDxX4TIVklhvvkPK29En9EmLAYuY+ZvWVQZ/7hG5e1U7AWRJUNs3sH4iugQ1Q6Yd/984WvuXcpNdiP9KWCiNiIOuUELfDB3/BSK1WOC7X8Pi9ir/VhVrExCkdXi0XLyAoSH62gR8rh5Q4ID1yig9cT2QkgqY0F5WMxQNs/RusJ0EBdZyCIgQI9rMkwnzWHL3v4XwC0qTLzuRNoZKBt4wXI8IrZ+i6L9zWyy4V40wFITt7Bq4J1SQ26EWhm9VVZpwEK1CqfMTf00Rt8M7aAKpbbIkBmxIV0qG7ZXLXYfmaVFz/rvvCYAInoZLT7gvKMciMsb+r8Xevyr9chfC1TOWmD6WYVzq9BTv8MlS7rQoXk+9yuIt1U37YYazBpNw+e+iAv6U19oU3LpW6HlxiM4tSOUNucjVd4oWkRb6U8L0TbfDBR1Mf6z71DXZE4lk9if75W7WthmEcW2KKZyyPLJbKEo3kfGCz/WUiunEYxw3JcQg1kcBy59NUvrgk4/nVx4Sw98W094hFrRogAjmMd6UoDSg6n4J7WWFTsEqUKJhJnonQwUypphwKND96SJSIK6Cja8U+Lp5ha2jP+t37GYxXpW9P7nrocigMQIiDGuemUfCm8GrmQsqgCPyWbrPTP+LtpSYpSFMQoEDt7Q2s1LmEksTr24gM3MtfKHedmOVOLnRS4cTkGC0SOJ+rsuZQ3hFDwReD08jghtzCCLdZT1xdIcYInFqYooJftYSRn9n7pd/EIvipvN36ZqJLO/LvpkLxXwDrn78Eabe4otiOop6OpiAyTHGkEZ1SYJXN6oX8YxvmuFxyOxUdWiMJl5lQR0OmqRwFwGUMY7aYG4kJR471kVbGIvDBDpFMKr6BOt1uqd9CbV3hXdLopd5nf+kn/AS6YDKGu/vFfNfdrCU7I/2JUqGLP94tkzXR1VyBoTJgz/4aDCUzzlke5bxxahz4dRMgCzUj+rFI+4oFJrCfFw6bwMqJDdPDYKIN4orA9HslAVloUVcutdtvx6qQDmDY4T3+CXJUWSSJlmpSsf9n2ezgy42S4Y0EQ327q+1rn90jXH1fOu8ctXTC7cUIRmnuaPITpls8mIdk2qnce5Cp7eMw84VpF0ggd5Tq3hoba0599sBkXbr3I1NB9XVOetH8FYBnCbb6CSmhLgkfaqPdP6G58+4zZYDtpvQNRna4Fj2vagOzP8FzsvmnTsuivqGWB1BcvjXA0tmXHG2hG2qPWs7UPJMLErA5PjVymOSA8juJGNSnlPMznrCSCcL5L3+p3+uJPnQ3zMnJDP1e66RK+K1jyL+hPTGhR35UB2QUe3ZhTax8oJQCfSqwI/t8jsXO8HLkd9vBar7pY3jIIljivZ36rhwBm9o/9/wx012GHvMFEMmW3t85bNjbb3nALxsT1tdKv0tdHglrxmncTbey1dQePhvWP6BSvOSfAI2PQglXLXe3g79SSK0ijHEcV52dOYPxp+oVyyBVoQydY91G25/1G7FmzCVzHItAtNK4r2uNXPpzUcVD7uTya0q/GMBO4CGOAkt4VpM8DP6hNsTG46YoVLoiw521jXsLFld7zLr7KErdLCDIKwsdqQaT7ar9LOWzYuZBDuacq/n99U7bnHyIkF9l5pMabQ3YKQp+RF8LthkW1xL5DMLknw8V/XlYz+kzhQ4I52jrqRP2vbS5P/qK0ubJzYgCQmRPDV6uKnfvs+g8zjsc100e5rIEE3YnHkVzM0AkWsk71eus6n0vtVMOfOZ9/ztSLl9phNX6mtVjvvd6UYtJR5p7H0kRnoVSAl+dOM5eYdis5tV+CYYLFW/fyJRMYEsmS4OyVT2MIp3RN0xUGsDXnOGn6LLnJ0yoURHjiTRfcMYYt7t2wLBP//DxKXuOKT+oCy7FV8kzBFdHDriL0QL1HyM0Rdbz831xZoXadWCHpAJmYkNLMRB5AdZFuqZgU7FSra4ZZ/z2VO7ZWcCqm/axGnpLXwGuMj5kZNm1U0dhj4NCZoT6EZFLYORIk0/Io3t4O/mHr2Ru9r21gkCQEkAyVFZ3WOma4/V35QNjaXZNJ3Lgwln4ZiYRJGya1hIbWp1db1XljRAAOIwUO+ix/5FUKgFW69pW167weLyXnJ0Pw+T9e3u0E97yx7OruAIvIHZkRNGQDd6EM5yVAH18lYpk0QA5cJ4Ll9PKPJT+wo9uXB7Z93c/7zUeZ6IdkVwuNTKQ+HSVLIwbJpmQ2FyUyI5PaQu4+KDfzNodSKh1oFnseOzIe6jZXkKIqa9noxJ8qGTaSL4CGL+Eah227WB4Vhdvjg
    config.yaml: AgCksKBWhNIipak1w5iuo6q7QQTB5OerUnfvK9pXvR9ksIWa/dGj3U6Mk9jYgGV02QbM8FdXny43Xg2aQ5YckXWbYPZYbhQBkHQsaVU15soc4X5JbzXtsEus5LTaCErIPTo+QvG4fdLcfLJDj4G0U5V0F9h2vHYM/aoyrYjksKVgoeuo7L4bDarVg1FBJAmI36jOzFo+fOGFZw1GBNLZ3MOL/lZPExiumXoRt+lL+8lgiyqDH4TC1+Tku2/K5eRc+ciwJgo9K4hRt1PyYhwhxIyIKOFT1WTKZwC3YXzZV9gAjQmeTGekfwjVTAD92CA/WDsDIPA6QB0LjwvNJS5DRXjxdwAlc+doAtwDViZYHFV9HysoL75DQgELEdizprrvVwwONKl3RfPghxsp7EcY1etdgN2plCjepKIjah4u3830GbSIJElfUY+HVTHMTaAHsXs0c8YsT9Udy206i7NM3xxdDPpOaJnldas3xD7/rGNdCcdHVk0FzCWg4xM8VqivLInk0k9Eau1/MJtYckKdHzLvsKfFo61ITLdKG9kGAGoQgYDObXi3y9V8CtwdHxkjLDDzM2p4+pBje06+M04XZcKJikUH226DA9NtWU1jRkoWL1F2xXvSMCR23uKu3lBFIVwozH46Ach9zsLG/+eKs1cXq/CwHcQWu5hn6rOOZscjuKA8/+iY/Vi5JKwynlpXSHk0GSCwA4w5mlXwKSeOyBI1Z54J54uwFrdMGeQBwnoDEqcivhqf1DSAb6176LlA6G3DnYYgW9B+kN+j8Mke65HMLaFqX84HoNL5H2yBhS+ltfOmVpNxe69icWlUwbHl0tDkfcO1o4ezzhNH1yjwqWpO3gw8xpTeb2qB1E05H1lGBqlBd+tYYdgeatXDQfX39OWIHsnPem+jEO8caGXkUCDqsItvn35E+JXZS9YbyGcwp1aDy1h8REDATetyQFwqekltqby3OPE3F3nriBqz6dXAT7aEc4GcZxAlJvjkQOgXQzIE6lwPSkIClXN9uecaP7UdlpEiOErXnGMrYL1Er6O+m6hZpZLJBRB+/UQx0PkV2dtVqNKRggEZZeRZv+gapuFJyhNVj2vZ/O/lyGl0QFWN28jSKYLkikJCHz2yiEj0/WAlK0NJbmL18rJiALhQls3skfqiE4Eyje2UKrnmhwh5xZXZIeWBHeMxNLK2
    homelab.json: AgBuIANrHV4kamCXj7qXopPrYOHrrJzLA6TTBBrhxqARulobem+RQIopa0Lx/D1x+n6qRA+K8xs6bu/eknmt+FPB0OmZmfJz5MibdaUlqMtuObady5pkmH7qLFyIMXYjUee0YYDT9qEStxkji4iM0kYYV8iWr2bLKa86QEbuTsopaqIy03nqAPVqyqUIHsytDcHlW8jsYJu4HNAI0F2VZpNcYlJVy8IvEqMll1IG3sTaCpgyIyyZERDoLSXvbiFD5x5kpfyR7HCueGaqZ9djl5nXRnYI6HjkMfS/YJxm7qL/fsgLx4krnL0X3e10sQRiS6lWmEcUyK7aN8elBsFzfpNZgOGMMqeHyreuf4Dfpz13haBxTEPJ8MhJJ9bnih4u4Xd9RaW38OpBPAXWxhyO+91vzUyPPlcpkZTWsTuMhnTf9LPuoRn0BHV4LuZy5iIco6N50E9c+Hd7ffmrpGumuqYjcVFk+NlViZp4b23bIdrl/us59NEmCK2bkCr4F/mUZD+l3CTgYxTwBocnyM2i/fWCvwWCSuCu0Cyy55D6onl88NuBFevTZsi7viLwt3CwZ2suunOXZctO3keVZY5/mqSMTEbgidUwbNNw4vgw8mApz71BudE6ZNwlDDwuX14bcFbHZp0CQZPyjx24xIKI7GJI2kXEjELdtThy/ypHmR8Tbuc6SAQm/o5ss/j6Ey6syn7aSspfzBmP6VarCqC/wtsEaqeIeATOZiDwor0Ww30gSydEikYkcdOfy2V47OEM4X2CKyfJmh6u2wK6OdoBeK1w80tUSPuRw7AhAdzP7aBrWZHvuErBs1YAzXK6bbfaEmurKK8PoCdkOptxWyqiIH1AwREvCm0l8T6ti455pCadAvrKC3kowCysLxcDOv9veMJ5vZndmVbulGK9lwXb8GujOg==
  template:
    data: null
    metadata:
      creationTimestamp: null
      name: tunnel
      namespace: cloudflared
---
apiVersion: v1
kind: Namespace
metadata:
  name: cloudflared
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - deployment.yaml
  - namespace.yaml
  - sealedsecret.yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cloudflared
  namespace: cloudflared
spec:
  replicas: 1
  selector:
    matchLabels:
      app: cloudflared
  template:
    metadata:
      labels:
        app: cloudflared
    spec:
      containers:
        - args:
            - tunnel
            - --config
            - /etc/cloudflared/config/config.yaml
            - run
          image: cloudflare/cloudflared:2023.6.0
          livenessProbe:
            failureThreshold: 1
            httpGet:
              path: /ready
              port: 2000
            initialDelaySeconds: 10
            periodSeconds: 10
          name: cloudflared
          volumeMounts:
            - mountPath: /etc/cloudflared/config/config.yaml
              name: config
              subPath: config.yaml
            - mountPath: /etc/cloudflared/creds/homelab.json
              name: creds
              subPath: homelab.json
            - mountPath: /etc/cloudflared/cert.pem
              name: cert
              subPath: cert.pem
      volumes:
        - name: creds
          secret:
            items:
              - key: homelab.json
                path: homelab.json
            secretName: tunnel
        - name: cert
          secret:
            items:
              - key: cert.pem
                path: cert.pem
            secretName: tunnel
        - name: config
          secret:
            items:
              - key: config.yaml
                path: config.yaml
            secretName: tunnel
---
credentials-file: /etc/cloudflared/creds/homelab.json
ingress:
  - hostname: blog.kyledev.co
    service: http://blog.blog.svc.cluster.local
  - hostname: argocd.kyledev.co
    service: http://argocd-server.argocd.svc.cluster.local
  - service: http_status:404
metrics: 0.0.0.0:2000
no-autoupdate: true
protocol: http2
tunnel: 34a29bd3-c367-4439-bc8d-32a6dbfc98ff
